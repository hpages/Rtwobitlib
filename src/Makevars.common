TWOBIT_SOURCE_DIR=twobit

INCLUDE_DIR=${R_PACKAGE_DIR}/include
USRLIB_DIR=${R_PACKAGE_DIR}/usrlib${R_ARCH}

## Preprocessor and linker options. Make sure the Rtwobitlib::pkgconfig()
## function (defined in R/zzz.R) produces the same PKG_CPPFLAGS and PKG_LIBS
## values.
PKG_CPPFLAGS=-D_FILE_OFFSET_BITS=64 -I"${INCLUDE_DIR}"
PKG_LIBS="${USRLIB_DIR}/libtwobit.a"

.PHONY: all twobit mk-include-dir mk-usrlib-dir populate-include-dir populate-usrlib-dir clean

all: Rtwobitlib.so

Rtwobitlib.so: populate-usrlib-dir R_init_Rtwobitlib.o

R_init_Rtwobitlib.o: populate-include-dir

twobit:
	cd "${TWOBIT_SOURCE_DIR}" && $(MAKE) -f "${TWOBIT_MAKEFILE}"

mk-include-dir:
	mkdir -p "${INCLUDE_DIR}"

mk-usrlib-dir:
	mkdir -p "${USRLIB_DIR}"

populate-include-dir: twobit mk-include-dir
	cd "${TWOBIT_SOURCE_DIR}" && cp *.h "${INCLUDE_DIR}"

clean:
	cd "${TWOBIT_SOURCE_DIR}" && $(MAKE) -f "${TWOBIT_MAKEFILE}" clean
